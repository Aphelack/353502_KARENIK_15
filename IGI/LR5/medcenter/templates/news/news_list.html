{% extends "base.html" %}
{% load static %}

{% block title %}Новости - Медицинский центр{% endblock %}

{% block content %}
<h1>Новости медицинского центра</h1>

<div>
    <!-- Search form -->
    <form method="get" action="{% url 'news_list' %}">
        <input type="text" name="search" placeholder="Поиск новостей..." value="{{ search_query|default:'' }}">
        <button type="submit">Найти</button>
    </form>
</div>

<div>
    <!-- Category filter -->
    <h3>Категории:</h3>
    <ul>
        <li><a href="{% url 'news_list' %}">Все категории</a></li>
        {% for category in categories %}
        <li>
            <a href="{% url 'news_list' %}?category={{ category.id }}">
                {{ category.name }}
            </a>
        </li>
        {% endfor %}
    </ul>
</div>

<div>
    {% if search_query %}
    <p>Результаты поиска для: <strong>{{ search_query }}</strong></p>
    {% endif %}

    {% if page_obj %}
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
            {% for news_item in page_obj %}
            <div style="border: 1px solid #ddd; padding: 15px;">
                {% if news_item.image %}
                <img src="{{ news_item.image.url }}" alt="{{ news_item.title }}" style="width: 100%; height: 200px; object-fit: cover;">
                {% else %}
                <img src="{% static 'images/news_default.svg' %}" alt="{{ news_item.title }}" style="width: 100%; height: 200px; object-fit: cover;">
                {% endif %}

                <h3>{{ news_item.title }}</h3>

                {% if news_item.category %}
                <p><small>Категория: {{ news_item.category.name }}</small></p>
                {% endif %}

                <p>{{ news_item.summary }}</p>

                <p><small>Опубликовано: {{ news_item.published_at|date:"d.m.Y" }}</small></p>
                <p><small>Автор: {{ news_item.author.get_full_name|default:news_item.author.username }}</small></p>

                <p><a href="{% url 'news_detail' news_item.slug %}">Читать далее →</a></p>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
        <div style="margin-top: 30px; text-align: center;">
            {% if page_obj.has_previous %}
            <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}">Первая</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}">Предыдущая</a>
            {% endif %}

            <span>Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>

            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}">Следующая</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}">Последняя</a>
            {% endif %}
        </div>
        {% endif %}
    {% else %}
        <p>Новости не найдены.</p>
    {% endif %}
</div>
{% endblock %}
