{% extends "base.html" %}

{% block title %}Запись на {{ service.name }} - Медицинский центр{% endblock %}

{% block content %}
<section>
    <article class="card">
        <h2>Информация об услуге</h2>
        <dl>
            <dt>Название:</dt>
            <dd>{{ service.name }}</dd>
            
            <dt>Стоимость:</dt>
            <dd>{{ service.price }} <abbr title="Белорусский рубль">BYN</abbr></dd>
            
            <dt>Описание:</dt>
            <dd>{{ service.description }}</dd>
        </dl>
    </article>
    
    <article class="card">
        <h3>Выберите дату и время для записи</h3>
        <form method="post">
            {% csrf_token %}
            {% regroup slots by date as slots_by_date %}
            {% for date_group in slots_by_date %}
            <div>
                <h4><time datetime="{{ date_group.grouper|date:'Y-m-d' }}">{{ date_group.grouper|date:"d.m.Y (l)" }}</time></h4>
                <div>
                    {% for slot in date_group.list %}
                        {% if slot.busy %}
                            <button class="btn" disabled>
                                <time datetime="{{ slot.start|time:'H:i' }}">{{ slot.start|time:"H:i" }}</time> (занято)
                            </button>
                        {% else %}
                            <button type="submit" name="slot" 
                                    value="{{ slot.date|date:'Y-m-d' }}|{{ slot.start|time:'H:i' }}|{{ slot.free_doctor }}" 
                                    class="btn">
                                <time datetime="{{ slot.start|time:'H:i' }}">{{ slot.start|time:"H:i" }}</time>
                            </button>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            <hr>
            {% endfor %}
        </form>
    </article>
    
    <nav>
        <a href="{% url 'service_list' %}" class="btn">← Назад к услугам</a>
    </nav>
</section>
{% endblock %}